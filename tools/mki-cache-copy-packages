#!/bin/ash -efu

pkgboxdir="${PKGBOX:?directory required}"

pkgbox="$pkgboxdir/aptbox"

payload() {
	stat --printf='%A\t%s\t%Y\n' "$makefile"

	if [ -d "$pkgbox/var" ]; then
		cd "$pkgbox/var"
		find -name '*_release' -exec cat '{}' '+'
		cd - >/dev/null
	fi

	local r
	for r in ${IMAGE_PACKAGES:-} ${IMAGE_PACKAGES_REGEXP:-}; do
		if [ -f "$r" ]; then
			r="$(readlink -ev "$r")" ||
				continue
			stat --printf='%A\t%s\t%Y\n' "$r"
		else
			printf '%s\n' "$r"
		fi
	done
}
